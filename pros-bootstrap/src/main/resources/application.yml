# PROS (Personal Reasoning OS) Configuration
# ==========================================
# Common settings for all environments

spring:
  application:
    name: pros

  # JPA Configuration (common)
  jpa:
    hibernate:
      ddl-auto: validate  # Use Flyway for migrations
    show-sql: false
    properties:
      hibernate:
        format_sql: true
        dialect: org.hibernate.dialect.PostgreSQLDialect
        jdbc:
          time_zone: UTC

  # Flyway Configuration
  flyway:
    enabled: true
    locations: classpath:db/migration
    baseline-on-migrate: true
    validate-on-migrate: true
    placeholders:
      embedding_dimensions: ${spring.ai.vectorstore.pgvector.dimensions:1536}

  # OAuth2 Client Configuration (Google, GitHub)
  # NOTE: OAuth2 is optional. Only configured if credentials are provided.
  # security:
  #   oauth2:
  #     client:
  #       registration:
  #         google:
  #           client-id: ${GOOGLE_CLIENT_ID:}
  #           client-secret: ${GOOGLE_CLIENT_SECRET:}
  #           scope:
  #             - email
  #             - profile
  #           redirect-uri: "{baseUrl}/api/oauth2/callback/google"
  #         github:
  #           client-id: ${GITHUB_CLIENT_ID:}
  #           client-secret: ${GITHUB_CLIENT_SECRET:}
  #           scope:
  #             - user:email
  #             - read:user
  #           redirect-uri: "{baseUrl}/api/oauth2/callback/github"
  #       provider:
  #         google:
  #           authorization-uri: https://accounts.google.com/o/oauth2/v2/auth
  #           token-uri: https://oauth2.googleapis.com/token
  #           user-info-uri: https://www.googleapis.com/oauth2/v3/userinfo
  #           user-name-attribute: sub
  #         github:
  #           authorization-uri: https://github.com/login/oauth/authorize
  #           token-uri: https://github.com/login/oauth/access_token
  #           user-info-uri: https://api.github.com/user
  #           user-name-attribute: id

  # Spring AI Configuration
  # Model selection (chat/embedding) is configured per profile
  # - local: Ollama (gpt-oss:20b + bge-m3)
  # - dev/prod: OpenAI (gpt-4o-mini + text-embedding-3-small)
  ai:
    # OpenAI configuration (used in dev/prod profiles)
    openai:
      api-key: ${OPENAI_API_KEY:}
      embedding:
        options:
          model: text-embedding-3-small
      chat:
        options:
          model: gpt-4o-mini
          temperature: 0.3  # Low temperature for consistent explanations

    # PGVector Store Configuration
    # Dimensions are set per profile:
    # - local: 1024 (bge-m3)
    # - dev/prod: 1536 (text-embedding-3-small)
    vectorstore:
      pgvector:
        index-type: HNSW
        distance-type: COSINE_DISTANCE
        dimensions: 1536  # Default for OpenAI, overridden in local profile
        initialize-schema: false  # Flyway handles this

# Server Configuration
server:
  port: ${SERVER_PORT:8080}
  servlet:
    context-path: /api

# CORS Configuration
cors:
  allowed-origins: ${CORS_ALLOWED_ORIGINS:http://localhost:3000}

# OAuth2 Redirect Configuration
oauth2:
  success-redirect-uri: ${OAUTH2_SUCCESS_REDIRECT_URI:http://localhost:3000/oauth/callback}

# JWT Configuration
jwt:
  secret: ${JWT_SECRET:default-secret-key-that-should-be-changed-in-production-environment-32chars}
  expiration-ms: ${JWT_EXPIRATION_MS:86400000}

# Actuator Configuration
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics
  endpoint:
    health:
      show-details: when_authorized

# Application-specific Configuration
pros:
  # Decision Engine Settings
  decision:
    # Default lambda (regret sensitivity) for new users
    default-lambda: 1.0
    # Default regret prior for new users
    default-regret-prior: 0.2
    # Number of evidence fragments to show
    evidence-count: 5
    # Number of fragments to search for similarity
    similarity-search-count: 20

  # Fragment Settings
  fragment:
    # Maximum text length
    max-text-length: 10000

  # LLM Explanation Settings
  explanation:
    # Timeout for LLM API calls (in seconds)
    timeout-seconds: 180
    # System prompt for explanation generation
    # CRITICAL: This enforces the "no recommendation" rule
    system-prompt: |
      You are an explanation assistant for PROS (Personal Reasoning OS).

      STRICT RULES:
      1. NEVER recommend, suggest, or advise any choice
      2. NEVER use phrases like "you should", "I recommend", "better option"
      3. NEVER judge user's values or emotions
      4. ONLY explain WHY the calculation produced these results
      5. ONLY summarize the evidence fragments
      6. ALWAYS use neutral, descriptive language

      Your role is to TRANSLATE calculations into human-readable explanations.
      You do NOT make decisions. The user makes decisions.
